<!DOCTYPE html>
<html>
<head>
    <title>Poop Leaderboard</title>
    <style>
        table {
            border-collapse: collapse;
            width: 80%;
            margin: 20px auto;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f4f4f4;
        }
        img {
            max-width: 100px;
            height: auto;
        }
    </style>
</head>
<body>
    <h1 style="text-align:center;">Poop Leaderboard</h1>
    <table>
        <thead>
            <tr>
                <th>Timestamp</th>
                <th>Sender</th>
                <th>Message ID</th>
                <th>Image</th>
            </tr>
        </thead>
        <tbody id="data"></tbody>
    </table>

    <script>
        const sheetId = "1MpbHvg3T6gLetHKB-x4X4o1JWPZf74Rb3fa62RZ7CZc";
        const apiKey = "AIzaSyBl3BqjTc4iHMFUOtCl-s-qgeNEgaUTlcA";
        const range = "Sheet1!A:D";

        fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`)
            .then(response => response.json())
            .then(data => {
                const rows = data.values;
                const table = document.getElementById("data");

                rows.slice(1).forEach(row => {
                    const tr = document.createElement("tr");

                    // Timestamp
                    const tdTimestamp = document.createElement("td");
                    tdTimestamp.textContent = row[0] || "";
                    tr.appendChild(tdTimestamp);

                    // Sender (first 16 chars, remove quotes)
                    const tdSender = document.createElement("td");
                    let sender = row[1] || "";
                    sender = sender.substring(0, 16).replace(/"/g, "");
                    tdSender.textContent = sender;
                    tr.appendChild(tdSender);

                    // Message ID
                    const tdMessage = document.createElement("td");
                    tdMessage.textContent = row[2] || "";
                    tr.appendChild(tdMessage);

                    // Image
                    const tdImage = document.createElement("td");
                    if (row[3]) {
                        const img = document.createElement("img");
                        img.src = `https://drive.google.com/thumbnail?id=${row[3]}&sz=w1000`;
                        tdImage.appendChild(img);
                    } else {
                        tdImage.textContent = "No Image";
                    }
                    tr.appendChild(tdImage);

                    table.appendChild(tr);
                });
            })
            .catch(error => console.error("Error loading data:", error));
    </script>
</body>
</html>
